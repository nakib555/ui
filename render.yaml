
services:
  # Full Stack Service (Monolith)
  # Serves both the Node.js API and the React Frontend
  - type: web
    name: agentic-ai-chat
    env: node
    # 'starter' plan is required to use Persistent Disks.
    # If you use 'free', remove the 'disk' section, but chat history will be lost on restarts.
    plan: starter
    # Build both client (Vite) and server (Node)
    # Using 'npm install' without flags since we moved build tools to dependencies
    # ensuring they install even with NODE_ENV=production
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: GEMINI_API_KEY
        sync: false # You will be prompted to enter this in the Render Dashboard
      - key: BACKEND_URL
        sync: false # Optional: Set if you need to override the API base URL
      - key: DATA_DIR
        value: /var/lib/data
    disk:
      name: agentic-data
      mountPath: /var/lib/data
      sizeGB: 1
